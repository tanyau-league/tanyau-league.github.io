<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>Yauchann | TanYauLEAGUE</title>
	<link rel="icon" href="main.ico">
	<link rel="stylesheet" href="index.css">
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100;300;500;700;900&display=swap"
		rel="stylesheet">
	<link
		href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
		rel="stylesheet">
	<style>
		#game button.tsumo,
		#game button.agari {
			border-color: transparent !important;
			border-width: 0 !important;
		}

		/* 整体背景和字体优化 */
		html,
		body {
			overflow: hidden;
			background-size: 300px;
		}

		* {
			padding: 0;
			margin: 0;
			font-family: 'Noto Sans SC';
			color: #2c3e50;
			box-sizing: border-box;
		}

		/* 游戏页面优化 */
		#game {
			background: rgba(255, 255, 255, 0.85);
		}

		#game button.reach {
			width: 50vh;
			height: 5vh;
			background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
			font-size: 3vh;
			line-height: 5vh;
			font-weight: 500;
			border-radius: 30px;
			border: 1px solid #ced4da;
			display: block;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			transition: all 0.2s ease;
		}

		#game button.reach:hover {
			background: linear-gradient(to bottom, #e9ecef, #dee2e6);
		}

		#game .kaze {
			font-size: 4vh;
			padding-right: 2vh;
			line-height: 7vh;
			color: #2980b9;
			font-weight: bold;
		}

		#game input {
			font-size: 3vh;
			height: 5vh;
			line-height: 4vh;
			text-align: center;
			width: 42vh;
			float: right;
			margin-top: 1vh;
			border: 2px solid #ced4da;
			background: #f8f9fa;
			border-radius: 8px;
			padding: 0 10px;
			box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
		}

		#game button.tsumo,
		button.agari {
			height: 5vh;
			font-size: 3vh;
			line-height: 5vh;
			width: 25vh;
			margin-bottom: 1vh;
			color: white;
			border: none;
			transition: all 0.2s ease;
		}

		#game button.tsumo {
			background: linear-gradient(to bottom, #e74c3c, #c0392b);
			border-radius: 30px 0 0 30px;
		}

		#game button.agari {
			background: linear-gradient(to bottom, #f39c12, #d35400);
			float: right;
			border-radius: 0 30px 30px 0;
		}

		#game button.tsumo:hover,
		#game button.agari:hover {
			filter: brightness(1.1);
		}



		#game .naka {
			background: rgba(255, 255, 255, 0.9);
			border: 2px solid #3498db;
			border-radius: 8px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
		}

		#game .naka p {
			text-align: center;
			font-size: 4vh;
			color: #2c3e50;
		}

		#game .naka button {
			background: linear-gradient(to bottom, #3498db, #2980b9);
			color: white;
			border: none;
			border-radius: 30px;
			font-size: 4vh;
			padding: 1vh 4vh;
			display: block;
			margin: 0 auto;
			margin-top: 1vh;
			cursor: pointer;
			box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
			transition: all 0.2s ease;
		}

		#game .naka button:hover {
			transform: translateY(-2px);
			box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
		}


		#game .next_round button {
			background: linear-gradient(to bottom, #9b59b6, #8e44ad);
			color: white;
			border: none;
			border-radius: 50%;
			font-size: 4vh;
			height: 20vh;
			width: 20vh;
			cursor: pointer;
			box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
			transition: all 0.2s ease;
		}

		#game .next_round button:hover {
			transform: scale(1.05);
		}


		/* 结算弹窗优化 */
		.haiiro {
			height: 100vh;
			width: 100vw;
			background: rgba(44, 62, 80, 0.7);
			position: absolute;
			top: 0;
			left: 0;
			z-index: 10;
		}

		.kessan,
		.ryk,
		.correction,
		.result,
		.hint {
			background: #ffffff;
			border: 2px solid #3498db;
			border-radius: 12px;
			box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
		}

		.kessan h2,
		.correction h2,
		.hint h1,
		.result h1 {
			color: #2980b9;
			border-bottom: 2px solid #ecf0f1;
			padding-bottom: 2vh;
			margin-bottom: 2vh;
		}

		.namelen #playerA {
			background: linear-gradient(to right, #e74c3c, #c0392b);
		}

		/* 放铳者选择按钮优化 */
		.namelen .playerB {
			background-color: #fff;
			/* 恢复白色背景 */
			border: 0.1vh solid #3498db;
			/* 使用主题色边框 */
			border-radius: 20px;
			padding: 1vh 2vh;
			margin: 0 0.5vh;
			display: inline-block;
			cursor: pointer;
			transition: all 0.2s ease;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

		/* 选中状态的放铳者按钮 */
		.namelen .playerB.selected {
			background: linear-gradient(to bottom, #3498db, #2980b9) !important;
			color: white !important;
			border-color: #2980b9 !important;
		}

		/* 未选中状态的放铳者按钮 */
		.namelen .playerB:not(.selected):hover {
			background: #e3f2fd !important;
		}

		.namelen span {
			border-radius: 20px;
			margin: 0 5px;
			padding: 5px 15px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

		/* 番数/符数选择区域优化 */
		.fandiv,
		.fudiv {
			padding: 1vh 0;
		}

		/* 番数/符数选择区域间距调整 */
		.fandiv {
			margin-bottom: 4vh;
			/* 增加底部间距 */
			padding-bottom: 2vh;
			/* 增加内边距 */
			border-bottom: 1px solid #ecf0f1;
			/* 添加分隔线 */
		}

		.fudiv {
			margin-top: 4vh;
			/* 增加顶部间距 */
			padding-top: 2vh;
			/* 增加内边距 */
		}

		#fan,
		#fu {
			list-style: none;
			display: flex;
			flex-wrap: wrap;
			gap: 1vh;
			/* 减小间距 */
		}

		#fan li,
		#fu li {
			height: 6vh;
			/* 保持增加的高度 */
			font-size: 2.8vh;
			/* 稍减小字体 */
			line-height: 6vh;
			/* 保持行高匹配高度 */
			padding: 0 1.5vh;
			/* 调整内边距 */
			background: #f8f9fa;
			border: 1px solid #3498db;
			border-radius: 12px;
			cursor: pointer;
			text-align: center;
			transition: all 0.2s ease;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

			/* 恢复原有宽度设置 */
			float: left;
			margin-right: 2vh;
			margin-bottom: 2vh;
		}

		#fan li {
			/* 番数按钮宽度恢复 */
			width: auto;
			/* 自动宽度 */
			min-width: 10vh;
			/* 最小宽度保证显示 */
			padding: 0 1vh;
			/* 调整内边距 */
		}

		#fu li {
			/* 符数按钮宽度恢复 */
			padding: 0 3vh;
			/* 恢复原有内边距 */
			width: auto;
			/* 自动宽度 */
		}

		/* 满贯及以上按钮特殊处理 */
		#fan li:nth-child(n+5) {
			width: auto;
			/* 自动宽度 */
			min-width: 16vh;
			/* 最小宽度保证显示 */
			padding: 0 1.5vh;
			/* 调整内边距 */
			font-size: 2.7vh;
			/* 稍小字体适应长文本 */
		}

		/* 选中状态 */
		#fan li.selected,
		#fu li.selected {
			background: linear-gradient(to bottom, #3498db, #2980b9);
			color: white;
			border-color: #2980b9;
		}

		/* 移除flex布局对宽度的影响 */
		#fan,
		#fu {
			display: block;
			overflow: hidden;
		}


		#fscore {
			display: inline-block;
			/* 改为行内块元素 */
			min-width: 35%;
			/* 设置最小宽度 */
			max-width: 90%;
			/* 设置最大宽度 */
			padding: 1.5vh 3vh;
			/* 调整内边距 */
			font-size: 4vh;
			background: #f8f9fa;
			border: 1px solid #3498db;
			border-radius: 12px;
			margin-top: 2vh;
			margin-left: 0;
			/* 确保左对齐 */
			text-align: center;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			box-sizing: border-box;
			transition: width 0.3s ease;
			/* 添加宽度过渡动画 */
			white-space: nowrap;
			/* 防止文字换行 */
			overflow: hidden;
			/* 隐藏溢出内容 */
			text-overflow: ellipsis;
			/* 添加省略号 */
			margin-left: -2.15vw;
		}

		#submit {
			background: linear-gradient(to bottom, #e74c3c, #c0392b);
			border: none;
			border-radius: 30px;
			color: white;
			cursor: pointer;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
			transition: all 0.2s ease;
			bottom: -2vh;
			right: 2vw;
		}

		#submit:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
		}

		.ryk button {
			border-radius: 8px;
			border: 1px solid #ced4da;
			background: #f8f9fa;
			transition: all 0.2s ease;
			cursor: pointer;
		}

		.ryk button:hover {
			background: #e9ecef;
			transform: translateY(-2px);
		}

		.ryk .ryuukyoku {
			background: #f8f9fa;
			border: 2px solid #3498db;
			border-radius: 8px;
			font-weight: bold;
			color: #2980b9;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		.ryk .ryuukyoku:hover {
			transform: scale(1.05);
		}

		.correction input {
			border: 2px solid #ced4da;
			border-radius: 8px;
			background: #f8f9fa;
			padding: 5px;
			text-align: center;
		}

		.correction .submit {
			background: linear-gradient(to bottom, #e74c3c, #c0392b);
			color: white;
			border: none;
			border-radius: 30px;
			cursor: pointer;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
			transition: all 0.2s ease;
		}

		.correction .submit:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
		}

		/* 结果页面优化 */
		.result ul.res li {
			background: #f8f9fa;
			border: 2px solid #ced4da;
			border-radius: 8px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			transition: all 0.2s ease;
		}

		.result ul.res li:hover {
			background: #e9ecef;
			transform: translateX(5px);
		}

		.result button {
			background: linear-gradient(to bottom, #3498db, #2980b9);
			color: white;
			border: none;
			border-radius: 30px;
			cursor: pointer;
			box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
			transition: all 0.2s ease;
		}

		.result button:hover {
			transform: translateY(-3px);
			box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
		}

		/* 按钮统一效果 */
		button {
			transition: all 0.2s ease;
			cursor: pointer;
		}

		button:hover {
			filter: brightness(1.05);
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
		}

		/* 响应式调整 */
		@media (max-width: 768px) {
			#mainpage h1 {
				font-size: 8vh;
			}

			#mainpage button {
				font-size: 4vh;
				padding: 6vh 8vh;
			}

			#game .jicha,
			#game .toicha,
			#game .kamicha,
			#game .shimocha {
				width: 45vh;
			}

			#game input {
				width: 35vh;
			}
		}
	</style>
</head>

<body>
	<div class="haiiro"></div>

	<div class="correction">
		<button onclick="modoru()">取消</button>
		<ul>
			<li>当前局（1~8）<input type="text"></li>
			<li>本场数<input type="text"></li>
			<li>供托数<input type="text"></li>
			<li>选手1 <span></span> 点数<input type="text"></li>
			<li>选手2 <span></span> 点数<input type="text"></li>
			<li>选手3 <span></span> 点数<input type="text"></li>
			<li>选手4 <span></span> 点数<input type="text"></li>
			<br>
			<li>核算总点数 <span></span> <button class="planb" onclick="chr()">地址栏不可隐藏点我</button></li>

		</ul>
		<button class="submit" onclick="correct()">确认</button>
	</div>
	<div class="kessan">
		<button onclick="modoru()">取消</button>
		<h2>点数变动</h2>
		<div class="namelen">
			<span id="playerA">选手A</span>
			<span id="oyaku">（庄/闲）</span>
			<span id="agariway">自摸/荣和</span>
			<span class="playerB" onclick="houchuu(1)">选手B</span>
			<span class="playerB" onclick="houchuu(2)">选手C</span>
			<span class="playerB" onclick="houchuu(3)">选手D</span>
		</div>
		<div class="fandiv">
			<ul id="fan">
				<li onclick="fan(1)">&nbsp;&nbsp;&nbsp;1番&nbsp;&nbsp;&nbsp;</li>
				<li onclick="fan(2)">&nbsp;&nbsp;&nbsp;2番&nbsp;&nbsp;&nbsp;</li>
				<li onclick="fan(3)">&nbsp;&nbsp;&nbsp;3番&nbsp;&nbsp;&nbsp;</li>
				<li onclick="fan(4)">&nbsp;&nbsp;&nbsp;4番&nbsp;&nbsp;&nbsp;</li>
				<li onclick="fan(5)">满贯（5番）</li>
				<li onclick="fan(6)">跳满（6~7番）</li>
				<li onclick="fan(7)">倍满（8~10番）</li>
				<li onclick="fan(8)">三倍满（11~12番）</li>
				<li onclick="fan(9)">役满（13番以上）</li>
				<li onclick="fan(10)">&nbsp;两倍役满&nbsp;</li>
				<li onclick="fan(11)">&nbsp;三倍役满&nbsp;</li>
				<li onclick="fan(12)">&nbsp;四倍役满&nbsp;</li>
				<li onclick="fan(13)">&nbsp;五倍役满&nbsp;</li>
				<li onclick="fan(14)">&nbsp;六倍役满&nbsp;</li>
			</ul>
		</div>
		<div class="fudiv">
			<ul id="fu">
				<li onclick="fu(1)">20符</li>
				<li onclick="fu(2)">25符</li>
				<li onclick="fu(3)">30符</li>
				<li onclick="fu(4)">40符</li>
				<li onclick="fu(5)">50符</li>
				<li onclick="fu(6)">60符</li>
				<li onclick="fu(7)">70符</li>
				<li onclick="fu(8)">80符</li>
				<li onclick="fu(9)">90符</li>
				<li onclick="fu(10)">100符</li>
				<li onclick="fu(11)">110符</li>
			</ul>
		</div>
		<p id="fscore">0</p>
		<button id="submit" onclick="submit()">确认</button>
	</div>
	<div class="ryk">
		<button onclick="modoru()">取消</button>
		<button class="chuuto" onclick="tsuki(2)">途中流局</button>
		<button class="jicha kas" onclick="tennpai(1)">未听/听牌</button>
		<button class="shimocha kas" onclick="tennpai(2)">未听/听牌</button>
		<button class="toicha kas" onclick="tennpai(3)">未听/听牌</button>
		<button class="kamicha kas" onclick="tennpai(4)">未听/听牌</button>
		<button class="jicha tas" onclick="ryuumann(1)">流局满贯</button>
		<button class="shimocha tas" onclick="ryuumann(2)">流局满贯</button>
		<button class="toicha tas" onclick="ryuumann(3)">流局满贯</button>
		<button class="kamicha tas" onclick="ryuumann(4)">流局满贯</button>
		<button class="ryuukyoku" onclick="tsuki(1)">确认<br>流局</button>
	</div>
	<ol>
		<li>
			<div id="mainpage">
				<img src="Group 1.svg" alt="">
				<h1>Yauchann</h1>
				<p>立直麻将对局计分</p>
				<button onclick="wap(1)">开始</button>
				<span>在平板上获得更好的使用体验<br>by Haraki</span>
				<div class="tsukaikata" onclick="wap(3)">使用说明</div>
			</div>
		</li>
		<li>
			<div id="game">
				<div class="jicha">
					<h1>25000</h1>
					<button class="tsumo" onclick="tsumo(1)">自摸</button>
					<button class="agari" onclick="ron(1)">荣和</button>
					<button class="reach" onclick="reach(1)">立直</button>
					<span class="kaze">東</span><input placeholder="请输入选手名" value="">
				</div>
				<div class="shimocha">
					<h1>25000</h1>
					<button class="tsumo" onclick="tsumo(2)">自摸</button>
					<button class="agari" onclick="ron(2)">荣和</button>
					<button class="reach" onclick="reach(2)">立直</button>
					<span class="kaze">南</span><input placeholder="请输入选手名" value="">
				</div>
				<div class="toicha">
					<h1>25000</h1>
					<button class="tsumo" onclick="tsumo(3)">自摸</button>
					<button class="agari" onclick="ron(3)">荣和</button>
					<button class="reach" onclick="reach(3)">立直</button>
					<span class="kaze">西</span><input placeholder="请输入选手名" value="">
				</div>
				<div class="kamicha">
					<h1>25000</h1>
					<button class="tsumo" onclick="tsumo(4)">自摸</button>
					<button class="agari" onclick="ron(4)">荣和</button>
					<button class="reach" onclick="reach(4)">立直</button>
					<span class="kaze">北</span><input placeholder="请输入选手名" value="">
				</div>
				<div class="naka">
					<p id="honnba">东1局 0 本场</p>
					<p id="kyoutaku">立直棒 0</p>
					<button onclick="ryuukyoku()">流局</button>
				</div>
				<div class="next_round">
					<button onclick="tsuki(0)">下一局</button>
				</div>
				<div class="correct" onclick="shuusei()">修正</div>
				<!-- 
					<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=3&id=3071025351&auto=0&height=66"></iframe> -->
			</div>
		</li>
		<li>
			<div class="result">
				<h1>结果报告</h1>
				<ul class="res">
					<li>
						<span class="resi">1位 </span><span class="resname">选手 1</span>
						<span class="respoint">+0.0 点</span><span class="resscore">25000 点</span>
					</li>
					<li>
						<span class="resi">2位 </span><span class="resname">选手 2</span>
						<span class="respoint">+0.0 点</span><span class="resscore">25000 点</span>
					</li>
					<li>
						<span class="resi">3位 </span><span class="resname">选手 3</span>
						<span class="respoint">+0.0 点</span><span class="resscore">25000 点</span>
					</li>
					<li>
						<span class="resi">4位 </span><span class="resname">选手 4</span>
						<span class="respoint">+0.0 点</span><span class="resscore">25000 点</span>
					</li>
				</ul>
				<button style="margin: 0 11vw;" onclick="new_game()">新的对局</button>
				<button onclick="data_out()">数据文件</button>
			</div>
		</li>
		<li>
			<div class="hint">
				<h1>使用说明</h1>
				<ul>
					<li><a onclick="wap(0)" class="wapp">回到主页</a></li>
					<li>建议使用平板横屏使用，本软件的设计目标是电子场风盘。</li>
					<li>如果要回到主页，直接刷新即可。</li>
					<li>进入对局后，在每个方向的最外侧有输入选手名的输入框. 请按照东南西北对应座次输入。</li>
					<li>自己进入立直状态，点击自家操作区的立直按钮。误操作再点击可以取消。</li>
					<li>自己自摸，点自家的自摸按钮，然后选择番数符数。</li>
					<li>自己荣和（他人放铳），点自家的荣和按钮，选择放铳者和番数符数。</li>
					<li>和牌后点击中间的下一局进入下一局。</li>
					<li>荒牌流局点中间流局按钮，四家各自选择是否听牌，以及是否达成流局满贯。</li>
					<li>八局结束后进入结算，原点25000，返点30000，顺位马+50+10-10-30</li>
					<li>目前所有规则均默认 tanyau-league 规则。</li>
					<li>如果出现操作错误或存档丢失，可以点击修正按钮手动修正。</li>
					<li>如果平板端等无法隐藏地址栏导致显示不全，可以点击修正按钮点击功能按钮。</li>
					<li>——————————————————————————————————————</li>
					<li><a onclick="wap(4)" class="wapp">关于数据文件 .yc 格式的解说</a></li>
					<li><a onclick="wap(5)" class="wapp">开发者函数解释</a></li>
					<li><a onclick="wap(6)" class="wapp">联系开发者</a></li>
				</ul>
			</div>
		</li>
		<li>
			<div class="hint">
				<h1>数据文件.yc格式</h1>
				<ul class="dm">
					<li><a onclick="wap(3)" class="wapp">回到上一页</a></li>
					<li>可以使用文本类阅读器打开，类似于 txt。</li>
					<li>一共有多行，每一行是一个语句，语句的不同成分用空格分隔，句首单词代表本句种类。每行以 \r\n 结尾。</li>
					<li>以下为所有语句种类：代表选手的数字 [X]等取值1~4 代表起家为东南西北顺</li>
					<li>round [A] honnba [B] kyoutaku [C] 表示当前是第 [A] 场，本场数 [B]，供托 [C]。</li>
					<li>reach [X] -1000 表示选手 [X] 立直</li>
					<li>tsumo [X1] +[x1] [X2] -[x2] [X3] -[x3] [X4] -[x4] 表示 [X1] 自摸，选手后数字代表点数变动</li>
					<li>ron [X1] +[x1] [X2] -[x2] 表示 [X1] 荣和 [X2]，选手后数字代表点数变动</li>
					<li>agari_kyoutaku [X1] +[x1] 表示 [X1] 和牌后收取供托，选手后数字代表点数变动</li>
					<li>howannpai_ryuukyoku [X1] [x1] [X2] [x2] [X3] [x3] [X4] [x4] 表示荒牌流局，后面为罚符</li>
					<li>ryuumann [X1] +[x1] [X2] -[x2] [X3] -[x3] [X4] -[x4] 表示 [X1] 流局满贯，后面为点数变动</li>
					<li>chuuto_ryuukyoku 表示中途流局</li>
					<li>correct round [] honnba [] kyoutaku [] score 1 [] score 2 [] score 3 [] score 4 []
						表示手动修正，将前面的变量改为后面的值</li>
					<li>score_check [X1] [x1] [X2] [x2] [X3] [x3] [X4] [x4] 表示四家分数，供检查用，可不处理</li>
					<li>以上为操作语句. 当 round 语句 A=9 时代表半庄终止，输出 score_check 后会按如下格式依1234次序输出选手信息：</li>
					<li>player [n] [name] [score] [rank] [pt] 表示选手 [n(1~4)] 的名字为 [name]，终局点数 [score]，排名
						[rank]（同分同排名），[pt] 代表段位分*10</li>
				</ul>
			</div>
		</li>
		<li>
			<div class="hint">
				<h1>开发者函数解释</h1>
				<ul class="dm">
					<li><a onclick="wap(3)" class="wapp">回到上一页</a></li>
					<li>以下均为 js 函数解释，可以在 console 中试验。</li>
					<li>wap(n)：代表跳转到 n 页面. 0：主页，1：对局页面，2：结算页面，3：说明，4：数据格式说明，5：开发者函数解释，6：联系开发者</li>
					<li>refresh_data()：刷新对局页面的渲染</li>
					<li>logx("str")：输出日志到 logs</li>
					<li>其他函数用法和变量请自行阅读，虽然代码逻辑较混乱.</li>
					<li>禁用了缩放屏幕大小，以及safari强制的滑动缩放等。如果不能收起地址栏的平板，修正后中间板和自家板会向上移动。</li>
				</ul>
			</div>
		</li>
		<li>
			<div class="hint">
				<h1>联系开发者</h1>
				<ul class="dm">
					<li><a onclick="wap(3)" class="wapp">回到上一页</a></li>
					<br>
					<li style="font-size: 5vh; ">Haraki</li>
					<li style="font-size: 3vh; ">2150864207@qq.com</li>
					<br>
					<li>本项目是为 <a href="https://tanyau-league.github.io/" target="_blank" class="wapp">Tanyau-league</a>
						组织而创作的.</li>
					<li>项目地址 <a href="https://github.com/tanyau-league/tanyau-league.github.io/tree/master/yc"
							target="_blank"
							class="wapp">https://github.com/tanyau-league/tanyau-league.github.io/tree/master/yc</a>
					</li>
				</ul>
			</div>
		</li>
	</ol>
</body>
<script type="text/javascript">
	const all_pages = document.querySelectorAll("body>ol>li")
	var score = [0, 25000, 25000, 25000, 25000];
	var round = 1, honnba = 0, kyoutaku = 0;
	var chrome_used = 0;
	var nowoya = 1;
	var elem_honnba = document.getElementById("honnba"), elem_kyoutaku = document.getElementById("kyoutaku");
	var elem_player = document.querySelectorAll("#game .jicha,#game .shimocha,#game .toicha,#game .kamicha");
	var reached = [0, 0, 0, 0, 0];
	var tennpaied = [0, 0, 0, 0, 0];
	var ryuumanned = [0, 0, 0, 0, 0];
	var order = [0, 1, 2, 3, 4];
	var elem_fans = document.querySelectorAll("#fan li");
	var elem_fus = document.querySelectorAll("#fu li");
	var selected_fan = -1, selected_fu = -1;
	var oyaku = 0;//0 亲 1 子
	var agaway = 0;//0 自摸 1荣和
	var pAname = "", pBname = "";
	var agarisha = 0, houchuusha = 0, houchuusha_idx = 0, fsA = 0, fsB = 0;
	const fusu = [0, 20, 25, 30, 40, 50, 60, 70, 80, 90, 100, 110];//符数
	const upscore = [0, 0, 0, 0, 0, 8000, 12000, 16000, 24000, 32000, 64000, 96000, 128000, 160000, 192000];//子家超5番荣和点数
	const uma = {
		111: [50000, 10000, -10000, -30000],
		112: [50000, 10000, -20000, -20000],
		120: [50000, 0, 0, -30000],
		130: [50000, -10000, -10000, -10000],
		201: [30000, 30000, -10000, -30000],
		202: [30000, 30000, -20000, -20000],
		300: [16800, 16600, 16600, -30000],
		400: [5000, 5000, 5000, 5000]
	}//马点
	const batsu = [[0, 0], [+3000, -1000], [+1500, -1500], [+1000, -3000], [0, 0]]; //不听罚符

	function wap(n) {
		for (let i = 0; i < all_pages.length; i++)
			if (i == n) all_pages[i].style.display = "block";
			else all_pages[i].style.display = "none";

		if (n == 1) {
			show_round();
			refresh_data();
		}
		else if (n == 2) {
			//计算分数
			let furui_score = [0, score[1], score[2], score[3], score[4]];// 存储旧分数，接下来会计算新的得点（分供托+顺位）
			let rank = [0, 1, 1, 1, 1];// 排名
			let cnt_1 = 0, cnt_2 = 0, cnt_3 = 0;//1位，2位，3位数量
			for (let i = 1; i <= 4; i++) {
				for (let j = 1; j <= 4; j++)if (score[j] > score[i]) rank[i]++;
				if (rank[i] == 1) cnt_1++;
				if (rank[i] == 2) cnt_2++;
				if (rank[i] == 3) cnt_3++;
			}
			//供托分配
			if (cnt_1 == 1 || cnt_1 == 2) {
				for (let i = 1; i <= 4; i++) if (rank[i] == 1) score[i] += parseInt(kyoutaku * 1000 / cnt_1);
			}
			else if (cnt_1 == 3) {
				let signal = 1;
				for (let i = 1; i <= 4; i++)if (rank[i] == 1) score[i] += Math.floor(kyoutaku / 3) * 1000;//先尽可能分整点1000	
				kyoutaku = kyoutaku % 3; //余下2000或1000供托
				for (let i = 1; i <= 4; i++)
					if (rank[i] == 1)
						if (signal == 1) signal = 0, score[i] += kyoutaku * 400;
						else score[i] += kyoutaku * 300;
			}
			kyoutaku = 0;

			//顺位点分配
			let temp_uma = uma[100 * cnt_1 + 10 * cnt_2 + cnt_3];
			for (let i = 1; i <= 4; i++)score[i] += temp_uma[i - 1];

			point = [0, 0, 0, 0, 0];
			for (let i = 1; i <= 4; i++)point[i] = (score[i] - 30000) / 100

			//冒泡排序
			order = [0, 1, 2, 3, 4];//order[i] 代表顺位 i 的选手
			for (let i = 1; i <= 4; i++)
				for (j = i + 1; j <= 4; j++)
					if (rank[order[j]] < rank[order[i]]) {
						let tem = order[i];
						order[i] = order[j];
						order[j] = tem;
					}
			for (let i = 1; i <= 4; i++) {
				document.querySelectorAll(".res .resi")[i - 1].innerText = rank[order[i]] + " 位 ";
				document.querySelectorAll(".res .resname")[i - 1].innerText = elem_player[order[i] - 1].querySelector("input").value;
				document.querySelectorAll(".res .resscore")[i - 1].innerText = furui_score[order[i]];
				let pt = point[order[i]];
				let str = "";
				if (pt >= 0) str = "+" + Math.floor(pt / 10.0) + "." + pt % 10;
				else str = "▲" + Math.floor(-pt / 10.0) + "." + (-pt) % 10;
				document.querySelectorAll(".res .respoint")[i - 1].innerText = str;
			}
			for (let i = 1; i <= 4; i++) score[i] = furui_score[i];
			for (let i = 1; i <= 4; i++) logx("player " + i + " " + elem_player[i - 1].querySelector("input").value + " " + score[i] + " " + rank[i] + " " + point[i]);

		}

	}
	function refresh_data() {
		if (round == 9) wap(2);
		nowoya = (round - 1) % 4 + 1;
		if (chrome_used == 1) {
			document.querySelector(".planb").style.backgroundColor = "#1ac";
			document.querySelector(".planb").style.color = "#fff";
			document.querySelector(".naka").style.marginTop = "-20vh";
			document.querySelector(".next_round").style.marginTop = "-20vh";
			document.querySelector("#game .kamicha").style.marginTop = "-21vh";
			document.querySelector("#game .shimocha").style.marginTop = "-21vh";
			document.querySelector("#game .jicha").style.marginBottom = "10vh";
		} else {
			document.querySelector(".planb").style.backgroundColor = "#fff";
			document.querySelector(".planb").style.color = "#000";
			document.querySelector(".naka").style.marginTop = "-15vh";
			document.querySelector(".next_round").style.marginTop = "-15vh";
			document.querySelector("#game .kamicha").style.marginTop = "-16vh";
			document.querySelector("#game .shimocha").style.marginTop = "-16vh";
			document.querySelector("#game .jicha").style.marginBottom = "0";
		}

		for (let i = 1; i <= 4; i++) {
			if (reached[i]) {
				elem_player[i - 1].querySelector(".reach").innerText = "●";
				elem_player[i - 1].querySelector(".reach").style.color = "#ee1f34";
			} else {
				elem_player[i - 1].querySelector(".reach").innerText = "立直";
				elem_player[i - 1].querySelector(".reach").style.color = "black";
			}
		}

		let kaze = "東 ";
		if (round > 4) kaze = "南 ";
		elem_honnba.innerText = kaze + ((round - 1) % 4 + 1) + " 局 " + honnba + " 本场";
		elem_kyoutaku.innerText = "立直棒 " + kyoutaku;
		for (let i = 1; i <= 4; i++)elem_player[i - 1].querySelector("h1").innerText = score[i];
		var kazelist = ["東", "南", "西", "北"];
		for (let i = 1; i <= 4; i++)elem_player[i - 1].querySelector(".kaze").innerText = kazelist[(i - nowoya + 8) % 4];

		let elem_pB = document.querySelectorAll(".playerB");
		/*
		for (let i = 1; i <= 3; i++) {
			if (i == houchuusha_idx) {
				elem_pB[i - 1].style.backgroundColor = "#37b";
				elem_pB[i - 1].style.color = "#fff";
			} else {
				elem_pB[i - 1].style.backgroundColor = "#fff";
				elem_pB[i - 1].style.color = "#000";
			}
		}
		*/
		for (let i = 1; i <= 4; i++) {
			if (tennpaied[i] == 1) {
				document.querySelectorAll(".ryk button.kas")[i - 1].innerText = "听牌";
				document.querySelectorAll(".ryk button.kas")[i - 1].style.backgroundColor = "#58a335";
				document.querySelectorAll(".ryk button.kas")[i - 1].style.color = "#fff";
			} else {
				document.querySelectorAll(".ryk button.kas")[i - 1].innerText = "未听";
				document.querySelectorAll(".ryk button.kas")[i - 1].style.backgroundColor = "#fff";
				document.querySelectorAll(".ryk button.kas")[i - 1].style.color = "#000";
			}
			if (ryuumanned[i] == 1) {
				document.querySelectorAll(".ryk button.tas")[i - 1].style.backgroundColor = "#6f33a3";
				document.querySelectorAll(".ryk button.tas")[i - 1].style.color = "#fff";
			} else {
				document.querySelectorAll(".ryk button.tas")[i - 1].style.backgroundColor = "#fff";
				document.querySelectorAll(".ryk button.tas")[i - 1].style.color = "#000";
			}
		}


		document.querySelector("#playerA").innerText = pAname;
		for (let i = 1; i <= 3; i++) {
			document.querySelectorAll(".playerB")[i - 1].style.display = "inline";
			document.querySelectorAll(".playerB")[i - 1].innerText = elem_player[(agarisha - 1 + i + 4) % 4].querySelector("input").value;
		}
		document.querySelector("#oyaku").innerText = ((oyaku == 0) ? "（亲）" : "（子）");
		if (agaway == 0) {
			document.querySelector("#agariway").innerText = "自摸";
			for (let i = 1; i <= 3; i++) document.querySelectorAll(".playerB")[i - 1].style.display = "none";
		}
		else document.querySelector("#agariway").innerText = "荣和";

		for (let i = 1; i <= elem_fans.length; i++) {
			elem_fans[i - 1].style.backgroundColor = (i == selected_fan ? "#e40" : "#fff");
			elem_fans[i - 1].style.color = (i == selected_fan ? "#fff" : "#000");
		}
		for (let i = 1; i <= elem_fus.length; i++) {
			elem_fus[i - 1].style.backgroundColor = (i == selected_fu ? "#71e" : "#fff");
			elem_fus[i - 1].style.color = (i == selected_fu ? "#fff" : "#000");
		}
		if ((selected_fu != -1 && selected_fan != -1) || (selected_fan >= 5)) {
			// 点数计算
			let temp = 0;
			if (oyaku == 0 && agaway == 0) {//亲自摸
				if (selected_fan >= 5) temp = parseInt(upscore[selected_fan] / 2);
				else {
					temp = 2 * fusu[selected_fu] * 4 * (2 ** selected_fan);
					if (temp > 4000) temp = 4000;
					temp = Math.ceil(temp / 100) * 100;
				}
				temp += honnba * 100;
				document.getElementById("fscore").innerText = temp + " ALL";
				fsA = temp;
			} else if (oyaku == 1 && agaway == 0) {//子自摸
				if (selected_fan >= 5) temp = parseInt(upscore[selected_fan] / 4);
				else {
					temp = fusu[selected_fu] * 4 * (2 ** selected_fan);
					if (temp > 2000) temp = 2000;
				}
				fsA = temp;
				fsA = Math.ceil(fsA / 100) * 100;
				fsA += honnba * 100;
				fsB = temp * 2;
				fsB = Math.ceil(fsB / 100) * 100;
				fsB += honnba * 100;
				document.getElementById("fscore").innerText = (fsA) + " " + (fsB);

			} else if (oyaku == 0 && agaway == 1) {//亲荣和
				if (selected_fan >= 5) temp = parseInt(upscore[selected_fan] / 2 * 3);
				else {
					temp = 6 * fusu[selected_fu] * 4 * (2 ** selected_fan);
					if (temp > 12000) temp = 12000;
					temp = Math.ceil(temp / 100) * 100;
				}
				temp += honnba * 300;
				fsA = temp;
				document.getElementById("fscore").innerText = temp + "";
			} else if (oyaku == 1 && agaway == 1) {//子荣和
				if (selected_fan >= 5) temp = parseInt(upscore[selected_fan]);
				else {
					temp = 4 * fusu[selected_fu] * 4 * (2 ** selected_fan);
					if (temp > 8000) temp = 8000;
					temp = Math.ceil(temp / 100) * 100;
				}
				temp += honnba * 300;
				fsA = temp;
				document.getElementById("fscore").innerText = temp + "";
			}
		}
	}
	function show_round() { logx("round " + round + " honnba " + honnba + " kyoutaku " + kyoutaku) }

	function reach(n) {
		if (!reached[n]) {
			score[n] -= 1000;
			kyoutaku++;
			logx("reach " + n + " -1000")
		} else {
			score[n] += 1000;
			kyoutaku--;
			for (let i = logs.length - 1; i >= 0; i--) {
				if (logs[i] == ("reach " + n)) {
					logs.splice(i, 1);
					break;
				}
			}
		}
		reached[n] = 1 - reached[n];
		refresh_data();
	}
	function fan(n) {
		selected_fan = n;
		// 移除所有选中状态
		document.querySelectorAll('#fan li').forEach(li => {
			li.classList.remove('selected');
		});
		// 添加当前选中状态
		if (n > 0) {
			document.querySelectorAll('#fan li')[n - 1].classList.add('selected');
		}
		refresh_data();
	}
	function fu(n) {
		selected_fu = n;
		// 移除所有选中状态
		document.querySelectorAll('#fu li').forEach(li => {
			li.classList.remove('selected');
		});
		// 添加当前选中状态
		if (n > 0) {
			document.querySelectorAll('#fu li')[n - 1].classList.add('selected');
		}
		refresh_data();
	}
	function modoru() {
		selected_fan = -1;
		selected_fu = -1;
		agarisha = 0;
		houchuusha = 0;
		houchuusha_idx = 0;
		kieru();
	}
	function tsumo(n) {
		agarisha = n;
		if (nowoya == n) {
			oyaku = 0;
		} else oyaku = 1;
		agaway = 0;
		pAname = elem_player[n - 1].querySelector("input").value;
		document.querySelector(".haiiro").style.display = "block";
		document.querySelector(".kessan").style.display = "block";
		document.querySelector(".kessan").style.rotate = (-(n - 1) * 90) + "deg";
		if (n % 2 == 0) {
			document.querySelector(".kessan").style.width = "76vh";
			document.querySelector(".kessan").style.height = "76vw";
			document.querySelector(".kessan").style.padding = "2vw 2vh";
		} else {
			document.querySelector(".kessan").style.width = "76vw";
			document.querySelector(".kessan").style.height = "76vh";
			document.querySelector(".kessan").style.padding = "2vh 2vw";
		}
		refresh_data();
	}
	function ron(n) {
		agarisha = n;
		if (nowoya == n) {
			oyaku = 0;
		} else oyaku = 1;
		agaway = 1;
		pAname = elem_player[n - 1].querySelector("input").value;
		document.querySelector(".haiiro").style.display = "block";
		document.querySelector(".kessan").style.display = "block";
		document.querySelector(".kessan").style.rotate = (-(n - 1) * 90) + "deg";
		if (n % 2 == 0) {
			document.querySelector(".kessan").style.width = "76vh";
			document.querySelector(".kessan").style.height = "76vw";
			document.querySelector(".kessan").style.padding = "2vw 2vh";
			for (let i = 1; i <= 3; i++) {
				document.querySelectorAll(".playerB")[i - 1].style.lineHeight = "7vh";
			}
		} else {
			document.querySelector(".kessan").style.width = "76vw";
			document.querySelector(".kessan").style.height = "76vh";
			document.querySelector(".kessan").style.padding = "2vh 2vw";
			for (let i = 1; i <= 3; i++) {
				document.querySelectorAll(".playerB")[i - 1].style.lineHeight = "0vh";
			}
		}
		refresh_data();
	}
	function submit() {
		document.querySelector(".haiiro").style.display = "none";
		document.querySelector(".kessan").style.display = "none";
		if (fsA <= 0) return;
		if (agaway == 1 && houchuusha == 0) return;
		if (oyaku == 0 && agaway == 0) {//亲自摸
			score[agarisha] += fsA * 3;
			let s = "tsumo " + agarisha + " +" + fsA * 3 + "";
			for (let i = 1; i <= 4; i++) {
				if (i != agarisha) {
					score[i] -= fsA;
					s += " " + i + " -" + fsA;
				}
			}
			logx(s)
		} else if (oyaku == 1 && agaway == 0) {//子自摸
			score[agarisha] += fsA * 2 + fsB;
			let s = "tsumo " + agarisha + " +" + (fsA * 2 + fsB) + "";
			for (let i = 1; i <= 4; i++) {
				if (i != agarisha && i != nowoya) {
					score[i] -= fsA;
					s += " " + i + " -" + fsA;
				} else if (i == nowoya) {
					score[i] -= fsB;
					s += " " + i + " -" + fsB;
				}
			}
			logx(s)
		} else if (oyaku == 0 && agaway == 1) {//亲荣和
			score[agarisha] += fsA;
			score[houchuusha] -= fsA;
			logx("ron " + agarisha + " +" + fsA + " " + houchuusha + " -" + fsA)
		} else if (oyaku == 1 && agaway == 1) {//子荣和
			score[agarisha] += fsA;
			score[houchuusha] -= fsA;
			logx("ron " + agarisha + " +" + fsA + " " + houchuusha + " -" + fsA)
		}
		//交立直棒
		score[agarisha] += kyoutaku * 1000;
		if (kyoutaku != 0) logx("agari_kyoutaku " + agarisha + " +" + kyoutaku * 1000)
		kyoutaku = 0;
		for (let i = 1; i <= 4; i++) {
			reached[i] = 0;
			elem_player[i - 1].querySelector(".reach").innerText = "立直";
			elem_player[i - 1].querySelector(".reach").style.color = "black";
		}

		document.querySelector(".next_round").style.display = "block";
		refresh_data();
		fsA = 0;
		fsB = 0;
		houchuusha = 0;
		selected_fan = 0;
		selected_fu = 0;
		houchuusha_idx = 0;
	}
	function tsuki(n) {
		if (n == 0) {
			if (agarisha == nowoya) {
				honnba++;
			} else {
				honnba = 0;
				round++;
			}
		} else if (n == 1) {
			//荒牌流局
			honnba++;
			if (tennpaied[nowoya] != 1) round++;
			let s = "howannpai_ryuukyoku";
			//不听罚符
			let tp_cnt = 0;
			for (let i = 1; i <= 4; i++)if (tennpaied[i]) tp_cnt++;

			for (let i = 1; i <= 4; i++) {
				if (tennpaied[i]) score[i] += batsu[tp_cnt][0], s += " " + i + " +" + batsu[tp_cnt][0];
				else score[i] += batsu[tp_cnt][1], s += " " + i + " " + batsu[tp_cnt][1];
			}
			logx(s);
			//流局满贯
			for (let i = 1; i <= 4; i++) {
				if (ryuumanned[i]) {
					s = "ryuumann";
					if (i == nowoya) {
						score[i] += 12000;
						s += " " + i + " +12000";
						for (let j = 1; j <= 4; j++) {
							if (i != j) score[j] -= 4000, s += " " + i + " -4000";
						}
					} else {
						score[i] += 8000;
						s += " " + i + " +8000";
						for (let j = 1; j <= 4; j++) {
							if (i != j && nowoya != j) score[j] -= 2000, s += " " + i + " -2000";
							else if (j == nowoya) score[j] -= 4000, s += " " + i + " -4000";
						}
					}
					logx(s);
				}
			}
		} else if (n == 2) {
			logx("chuuto_ryuukyoku");
			honnba++;
		} else {
			return;
		}
		kieru();
		show_round();
		logx("score_check" + " 1 " + score[1] + " 2 " + score[2] + " 3 " + score[3] + " 4 " + score[4]);
		agarisha = 0, houchuusha = 0;
		tennpaied = [0, 0, 0, 0, 0];
		ryuumanned = [0, 0, 0, 0, 0];
		reached = [0, 0, 0, 0, 0];
		refresh_data();
	}
	function ryuukyoku() {
		document.querySelector(".haiiro").style.display = "block";
		document.querySelector(".ryk").style.display = "block";
	}
	function tennpai(n) {
		tennpaied[n] = 1 - tennpaied[n];
		refresh_data();
	}
	function ryuumann(n) {
		ryuumanned[n] = 1 - ryuumanned[n];
		refresh_data();
	}
	function houchuu(n) {
		// 移除所有playerB元素的selected类
		document.querySelectorAll('.playerB').forEach(el => {
			el.classList.remove('selected');
		});

		// 给当前选中的playerB添加selected类
		document.querySelectorAll('.playerB')[n - 1].classList.add('selected');
		houchuusha_idx = n;
		houchuusha = (agarisha - 1 + n + 4) % 4 + 1;
		refresh_data();
	}
	var elem_cr = document.querySelectorAll(".correction input");
	function shuusei() {
		document.querySelector(".correction").style.display = "block";
		elem_cr[0].value = round, elem_cr[1].value = honnba, elem_cr[2].value = kyoutaku;
		for (let i = 0; i < 4; i++) {
			elem_cr[3 + i].value = score[i + 1];
			document.querySelectorAll(".correction span")[i].innerText = elem_player[i].querySelector("input").value;
		}
		calc();
	}
	function correct() {
		round = parseInt(elem_cr[0].value);
		honnba = parseInt(elem_cr[1].value);
		kyoutaku = parseInt(elem_cr[2].value);
		let s = "correct" + " round " + round + " honnba " + honnba + " kyoutaku " + kyoutaku;
		for (let i = 0; i < 4; i++) {
			score[i + 1] = parseInt(elem_cr[3 + i].value);
			s += " score " + (i + 1) + " " + score[i + 1];
		}
		logx(s);
		kieru();
		refresh_data();
	}
	function kieru() {
		//各种窗口全部消失
		document.querySelector(".next_round").style.display = "none";
		document.querySelector(".haiiro").style.display = "none";
		document.querySelector(".kessan").style.display = "none";
		document.querySelector(".ryk").style.display = "none";
		document.querySelector(".correction").style.display = "none";
	}
	kieru();
	wap(0);

	//监听修正文本，然后计算
	for (let i = 0; i < 7; i++)document.querySelectorAll(".correction input")[i].oninput = calc;

	function calc() {
		let ans = 0;
		ans += parseInt(document.querySelectorAll(".correction input")[2].value) * 1000;
		for (let i = 0; i < 4; i++)ans += parseInt(document.querySelectorAll(".correction input")[3 + i].value);
		document.querySelectorAll(".correction span")[4].innerText = ans;
	}

	//平板 chrome 特攻
	function chr() {
		chrome_used = 1 - chrome_used;
		refresh_data();
	}

	//日志记录，输出部分
	var logs = [];
	function logx(s) {
		console.log(s);
		logs.push(s);
	}
	function data_out() {
		let s = "";
		for (let i = 0; i < logs.length; i++)s += logs[i] + "\r\n";
		download("Mahjong" + Date.now() + ".yc", s);
	}
	function new_game() {
		score = [0, 25000, 25000, 25000, 25000];
		kyoutaku = 0, round = 1, honnba = 0, nowoya = order[1];
		reached = [0, 0, 0, 0, 0];
		selected_fan = -1, selected_fu = -1, oyaku = 0, agaway = 0, pAname = "", pBname = "";
		agarisha = 0, houchuusha = 0, houchuusha_idx = 0, fsA = 0, fsB = 0;
		tennpaied = [0, 0, 0, 0, 0];
		ryuumanned = [0, 0, 0, 0, 0];
		wap(1);

	}
	function download(filename, text) {
		var element = document.createElement('a');
		element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
		element.setAttribute('download', filename);
		element.style.display = 'none';
		document.body.appendChild(element);
		element.click();
		document.body.removeChild(element);
	}
	// safari 特攻
	window.onload = function () {
		document.addEventListener('touchstart', function (event) {
			if (event.touches.length > 1) {
				event.preventDefault();
			}
		});
		var lastTouchEnd = 0;
		document.addEventListener('touchend', function (event) {
			var now = (new Date()).getTime();
			if (now - lastTouchEnd <= 300) {
				event.preventDefault();
			}
			lastTouchEnd = now;
		}, false);
		document.addEventListener('gesturestart', function (event) {
			event.preventDefault();
		});
	}
</script>

</html>