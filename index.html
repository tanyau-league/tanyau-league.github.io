<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>TanYauLEAGUE</title>
	<link rel="icon" href="img/main.ico">
	<link rel="stylesheet" href="css/index.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100;300;500;700;900&display=swap"
		rel="stylesheet">
	<link
		href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
		rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@200..900&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200..900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
	<div class="top">
		<img src="img/Group 1.svg" alt="logo">
		<ul>
			<li><a href="#" class="selected">首页</a></li>
			<li>
				<div class="dropdown">
					<a class="dropbtn" href="#game-main">
						赛事
					</a>
					<div class="dropdown-content">
						<a href="#game" style="margin-top:10px">对战成绩</a>
						<a href="#event" style="margin-top: 0">赛程安排</a>
					</div>
				</div>
			</li>
			<li><a href="#mate">成员</a></li>
			<li><a href="#rule">规则</a></li>
			<li><a href="#contact">联络</a></li>
		</ul>
	</div>
	<a name="banner" class="target-fix"></a>
	<div class="banner" id="bottom">
		<h1>TanYau.LEAGUE,</h1>
		<h2>麻雀の真実を求もう。</h2>
		<p id="short_intro">
			面向 THU 求真书院同学的立直麻将团体。<br>致力于推广立直麻将，以更科学的视角解读和研究麻将技术。
		</p>
		<a href="#contact">加入我们</a>
		<ul>
			<li><img src="img/1m.svg" alt=""></li>
			<li><img src="img/9m.svg" alt=""></li>
			<li><img src="img/1p.svg" alt=""></li>
			<li><img src="img/9p.svg" alt=""></li>
			<li><img src="img/1s.svg" alt=""></li>
			<li><img src="img/9s.svg" alt=""></li><br>
			<li><img src="img/1z.svg" alt=""></li>
			<li><img src="img/2z.svg" alt=""></li>
			<li><img src="img/3z.svg" alt=""></li>
			<li><img src="img/4z.svg" alt=""></li>
			<li><img src="img/5z.svg" alt=""></li>
			<li><img src="img/6z.svg" alt=""></li>
			<li><img src="img/7z.svg" alt=""></li>
		</ul>
	</div>
	<a name="game-main" class="target-fix"></a>
	<div class="game-main"></div>
	<a name="game" class="target-fix"></a>
	<div class="game">
		<div class="rightpart">
			<h1>リーチ麻雀、</h1>
			<h2>好牌合理放铳，烂牌坚决不怂<br>有人立直加杠，搏敌生于非洲</h2>
			<a href="historical_rankings.html" target="_blank">往届对战数据 <span> >>> </span></a>
		</div>
		<div class="leftpart">
			<img src="img/2025Autumn.png" width="225" height="71">
		</div>
		<div class="ranklist">
			<div class="Title1">
				<h3 style="font-size:36px">個人スコア</h3><br>
				<ul id="pointRanking"></ul>
			</div>
			<div class="Title2">
				<h3 style="font-size:36px">最高スコア</h3><br>
				<ul id="highScoreRanking"></ul>
			</div>
			<div class="Title3">
				<h3 style="font-size:36px">4着回避率</h3><br>
				<ul id="avoidanceRanking"></ul>
			</div>
		</div>
	</div>
	<a name="event" class="target-fix"></a>
	<div class="event">
		<h1 style="font-size: 48px; text-align: center;">Coming Events:</h1>
		<div class="event-card">
			<div class="event-header">
				<span class="event-type">赛季开始</span>
				<div class="event-title">
					<i class="fas fa-flag-checkered"></i>
					<h2>2025年秋季赛开赛</h2>
				</div>
				<div class="event-date">
					<i class="far fa-calendar"></i> 2025年9月
				</div>
			</div>

			<div class="event-content">
				<div class="info-item">
					<div class="info-icon">
						<i class="fas fa-calendar-day"></i>
					</div>
					<div class="info-text">
						<h3>比赛轮次</h3>
						<p>15场正式比赛</p>
					</div>
				</div>

				<div class="info-item">
					<div class="info-icon">
						<i class="fas fa-clock"></i>
					</div>
					<div class="info-text">
						<h3>比赛频率</h3>
						<p>每周举办1到2轮比赛</p>
					</div>
				</div>

				<div class="participants-section">
					<div class="section-title">
						<i class="fas fa-users"></i>
						<h3>参赛选手</h3>
					</div>
					<div class="participants-list">
						<div class="participant">2yrold</div>
						<div class="participant">Haraki</div>
						<div class="participant">Dawn</div>
						<div class="participant">Xiaobukeai</div>
						<div class="participant">zhunzhun</div>
						<div class="participant">Koihs</div>
						<div class="participant">多元外卷人</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="historical-link" style="text-align: center"><br><br><a href="historical_events.html">Historical
			Events</a></div>
	<a name="mate" class="target-fix"></a>
	<div class="mate">
		<h1>团体成员<span>リーグメンバー</span></h1>
		<ul>
			<li>
				<img src="img/gradeid/4p.svg" alt="">
				<span>四代目雀士</span>
				<ol>
					<li>多元外卷人</li>
					<li>Xiaobukeai</li>
					<li>Koihs</li>
				</ol>
			</li>
			<li>
				<img src="img/gradeid/5p.svg" alt="">
				<span>五代目雀士</span>
				<ol>
					<li>2yrold</li>
					<li>Dawn</li>
					<li>Haraki</li>
					<li>zhunzhun</li>
				</ol>
			</li>
		</ul>
	</div>
	<a name="rule" class="target-fix"></a>
	<div class="rule">
		<h1>—— 团体规则 ——</h1>
		<h2>リーグルール</h2>
		<h3>（2025年3月19日 修订）</h3>
		<strong>
			<p>一&nbsp;&nbsp;&nbsp;&nbsp;成员要求 </p><span></span>
		</strong>
		<p>我们只要求成员是求真书院（北京）的同学。为了更好地参与团体活动，建议对立直麻将有兴趣的初心者可以先在雀魂或其他平台进行简单的规则学习和对局练习。</p>
		<p>加入团体是免费的。</p>
		<p>成为本团体的成员之后，禁止有以下行为：</p>
		<ol>
			<li>
				<p>在未得到许可的情况下、以个人名义发布邀请加入团体等宣传信息（具体地，邀请他人加入时或者发布宣传信息时应该征求大家的同意，以防使用不当言词导致的错误理解，容易招引不必要的误会）；</p>
			</li>
			<li>
				<p>不应该阻碍团体活动正常进行（如多次无故临时拒绝到场、损坏用具等）；</p>
			</li>
			<li>
				<p>不得以团体的名义或使用团体的名字、图标等作为个人私用，特别是营利或非法的目的；</p>
			</li>
			<li>
				<p>行为违反法律法规和学校规定。</p>
			</li>
		</ol>
		<p>违反以上规则的，特别是第 2-4 条，经讨论，一般建议退出团体。</p>
		<strong>
			<p>二&nbsp;&nbsp;&nbsp;&nbsp;比赛规则 </p><span></span>
		</strong>
		<p><a href="rule.html">积分赛规则</a></p>
		<p>比赛犯规及处理：</p>
		<ol>
			<li>
				<p>错和（未听、振听、无役、立直改形杠）、不可恢复的炸牌山、诈立直（流局检查）：罚满贯。</p>
			</li>
			<li>
				<p>中途的多牌、少牌，错吃碰杠、误发声：和了放弃。</p>
			</li>
			<li>
				<p>为提高效率，在参赛者一致同意情况下，部分可改正的犯规直接改正即可（如配牌少牌、轻微炸山等）。</p>
			</li>
			<li>
				<p>罚满贯：若为庄家，支付4000all；若为子家，支付 2000,4000. 多人同时需要罚满贯时均计算。</p>
			</li>
			<li>
				<p>和了放弃：不能吃碰杠立直和牌，流局时视为未听牌。</p>
			</li>
			<li>
				<p>规则未能讨论的情况具体由在场者讨论决定。</p>
			</li>
		</ol>
		<p>计分：每学期作为新的赛季，积分清零，另设最高得点赏、避四赏和役满赏.</p>
		<strong>
			<p>三&nbsp;&nbsp;&nbsp;&nbsp;团体活动 </p><span></span>
		</strong>
		<p>除进行比赛以外、团体还会举行其他活动。目前有作为娱乐项目的如线上雀魂友人间、线下万象修罗等对战，记录分数但不计入比赛分数。</p>
		<strong>
			<p>四&nbsp;&nbsp;&nbsp;&nbsp;团体组织和财务 </p><span></span>
		</strong>
		<p>团体目前没有设立组织者或管理者，主要事务由商议决定。</p>
		<p>为避免麻将与赌博之嫌、团体决定不设置任何与金钱有关的竞技奖赏。</p>
		<div class="clear"></div>
	</div>
	<a name="contact" class="target-fix"></a>
	<div class="contact">
		<h1>联系我们</h1>
		<p><b>提交加入团体意愿：</b>联系微信号 harakiseki 或 robotsang 并注明班级和来意。我们很欢迎你的加入！</p>
		<p><b>合作意向交流：</b>微信号 harakiseki、robotsang.</p>
		<img src="img/9renn/1m.svg" alt="" id="firstimg">
		<img src="img/9renn/1m.svg" alt="">
		<img src="img/9renn/1m.svg" alt="">
		<img src="img/9renn/2m.svg" alt="">
		<img src="img/9renn/3m.svg" alt="">
		<img src="img/9renn/4m.svg" alt="">
		<img src="img/9renn/5m.svg" alt="">
		<img src="img/9renn/6m.svg" alt="">
		<img src="img/9renn/7m.svg" alt="">
		<img src="img/9renn/8m.svg" alt="">
		<img src="img/9renn/9m.svg" alt="">
		<img src="img/9renn/9m.svg" alt="">
		<img src="img/9renn/9m.svg" alt="">
	</div>
	<div class="footer">
		<p>本团体的图标·名字等与现实人物、事情无关。</p>
		<p>本团体为非盈利组织，仅为爱好者组织的个人团体。</p>
		<p>页面编辑：Haraki&2yrold &nbsp;&nbsp;&nbsp;&nbsp; 最后编辑日期：2025 年 6 月 19 日</p>
		<img src="img/Group 1w.svg" alt="">
	</div>
	<div id="clickEffectContainer"></div>
	<script>
		// 玩家数据结构定义（类似C语言的结构体）
		class Player {
			constructor(name, point, highScore, avoidanceRate) {
				this.name = name;
				this.point = point;
				this.highScore = highScore;
				this.avoidanceRate = avoidanceRate;
			}
		}
		// 玩家数据库（类似结构体数组）
		const playerDatabase = [
			new Player("2yrold", 0, 0, 0),
			new Player("Haraki", 0, 0, 0),
			new Player("多元外卷人", 0, 0, 0),
			new Player("Dawn", 0, 0, 0),
			new Player("Koihs", 0, 0, 0),
			new Player("Xiaobukeai", 0, 0, 0),
			new Player("zhunzhun", 0, 0, 0)
		];
		// 玩家数据操作接口
		const PlayerManager = {
			// 获取所有玩家数据
			getAllPlayers: function () {
				return [...playerDatabase];
			},

			// 按名称查找玩家
			getPlayerByName: function (name) {
				return playerDatabase.find(player => player.name === name);
			},

			// 更新玩家数据
			updatePlayer: function (name, data) {
				const player = this.getPlayerByName(name);
				if (player) {
					Object.assign(player, data);
					return true;
				}
				return false;
			},

			// 添加新玩家
			addPlayer: function (name, point = 0, highScore = 0, avoidanceRate = 0) {
				if (!this.getPlayerByName(name)) {
					playerDatabase.push(new Player(name, point, highScore, avoidanceRate));
					return true;
				}
				return false;
			},

			// 删除玩家
			removePlayer: function (name) {
				const index = playerDatabase.findIndex(p => p.name === name);
				if (index !== -1) {
					playerDatabase.splice(index, 1);
					return true;
				}
				return false;
			},

			// 按积分排序
			sortByPoints: function () {
				return [...playerDatabase].sort((a, b) => b.point - a.point);
			},

			// 按最高分排序
			sortByHighScore: function () {
				return [...playerDatabase].sort((a, b) => b.highScore - a.highScore);
			},

			// 按回避率排序
			sortByAvoidanceRate: function () {
				return [...playerDatabase].sort((a, b) => b.avoidanceRate - a.avoidanceRate);
			}
		};
		// 排行榜渲染器
		const RankRenderer = {
			// 生成单个玩家项的HTML
			_generatePlayerHTML: function (player, rank, criteria) {
				const isFirst = rank === 0;
				const bgColor = isFirst ? "#3b863e" : "#ffffff";
				const textColor = isFirst ? "white" : "black";
				const fontWeight = rank >= 3 ? "400" : "normal";

				// 根据标准格式化值
				let value;
				if (criteria === 'point') {
					value = (player.point >= 0 ? "+" : "") + player.point.toFixed(1);
				} else if (criteria === 'highScore') {
					value = player.highScore.toLocaleString();
				} else {
					value = player.avoidanceRate.toFixed(3);
				}

				return `
        <li style="background-color: ${bgColor}">
            <ol>
                <li>
                    <svg width="24px" height="40px" style="vertical-align: middle;position: relative">
                        <circle cx="12" cy="16" r="12" fill="white" />
                        <text x="12" y="22" font-family="Times New Roman" font-size="16"
                            text-anchor="middle" fill="${isFirst ? "#3b863e" : "black"}" 
                            ${rank >= 3 ? 'style="font-weight:400"' : ''}>${rank + 1}
                        </text>
                    </svg>
                    <p style="display:inline; color:${textColor}; ${rank >= 3 ? 'font-weight:400;' : ''}">
                        ${player.name}
                    </p>
                    <span style="display:inline; color:${textColor}">${value}</span>
                </li>
            </ol>
        </li>`;
			},

			// 渲染单个排行榜
			renderRanking: function (containerId, players, criteria) {
				const container = document.getElementById(containerId);
				if (!container) return;

				container.innerHTML = players.map((player, index) =>
					this._generatePlayerHTML(player, index, criteria)
				).join("");
			},

			// 渲染所有排行榜
			renderAllRankings: function () {
				this.renderRanking('pointRanking', PlayerManager.sortByPoints(), 'point');
				this.renderRanking('highScoreRanking', PlayerManager.sortByHighScore(), 'highScore');
				this.renderRanking('avoidanceRanking', PlayerManager.sortByAvoidanceRate(), 'avoidanceRate');
			}
		};
		// 页面加载时初始化排行榜
		document.addEventListener('DOMContentLoaded', function () {
			RankRenderer.renderAllRankings();
		});
		// 从GitHub获取并处理对局数据
		async function updatePlayerData() {
			try {
				// 获取仓库文件列表
				const response = await fetch('https://api.github.com/repos/tanyau-league/tanyau-league-data/contents/');
				if (!response.ok) throw new Error('GitHub API请求失败: ' + response.status);

				const files = await response.json();

				// 筛选对局数据文件
				const matchFiles = files.filter(file =>
					file.name.startsWith('TanyauData') &&
					file.name.endsWith('.json') &&
					file.type === 'file'
				).filter(file => {
					// 添加这一行日期过滤代码
					const timestamp = file.name.replace('TanyauData', '').replace('.json', '');
					const fileDate = new Date(
						parseInt(timestamp.substring(0, 4)),    // 年
						parseInt(timestamp.substring(4, 6)) - 1, // 月（0-11）
						parseInt(timestamp.substring(6, 8))      // 日
					);
					return fileDate >= new Date(2025, 8, 1); // 2025年9月1日
				});

				// 处理每个对局文件
				for (const file of matchFiles) {
					try {
						const fileResponse = await fetch(file.download_url);
						if (!fileResponse.ok) continue;

						const matchData = await fileResponse.json();

						// 查找终局玩家信息
						const playerInfo = matchData.logs.find(log => log.type === 'player_info');
						if (!playerInfo || !playerInfo.player) continue;

						// 更新每个玩家的统计数据
						playerInfo.player.forEach(player => {
							// 在playerDatabase中查找玩家
							const dbPlayer = PlayerManager.getPlayerByName(player.name);
							if (!dbPlayer) return;

							// 更新段位分（累加）
							PlayerManager.updatePlayer(player.name, {
								point: dbPlayer.point + (player.point / 10)
							});

							// 更新最高得点
							if (player.score > dbPlayer.highScore) {
								PlayerManager.updatePlayer(player.name, {
									highScore: player.score
								});
							}

							// 更新避四率相关统计（使用PlayerManager更新）
							if (!dbPlayer._stats) {
								PlayerManager.updatePlayer(player.name, {
									_stats: {
										totalGames: 0,
										fourthPlace: 0
									}
								});
							}

							// 更新统计
							const newStats = { ...dbPlayer._stats };
							newStats.totalGames++;
							if (player.rank === 4) newStats.fourthPlace++;

							PlayerManager.updatePlayer(player.name, {
								_stats: newStats
							});
						});
					} catch (fileError) {
						console.error(`处理文件 ${file.name} 时出错:`, fileError);
					}
				}

				// 计算避四率并清理临时数据
				playerDatabase.forEach(player => {
					if (player._stats) {
						PlayerManager.updatePlayer(player.name, {
							avoidanceRate: (player._stats.totalGames - player._stats.fourthPlace) / player._stats.totalGames,
							_stats: undefined // 清理临时数据
						});
					}
				});

				console.log('玩家数据更新完成');
				console.log('更新后的玩家数据库:', playerDatabase);

				// 关键修复：数据更新后重新渲染排行榜
				RankRenderer.renderAllRankings();
			} catch (error) {
				console.error('数据更新失败:', error);
			}
		}
		// 页面加载时自动更新数据
		window.addEventListener('DOMContentLoaded', function () {
			// 先渲染一次初始排行榜（显示0数据）
			RankRenderer.renderAllRankings();

			// 然后开始更新数据，更新完成后会自动重新渲染
			updatePlayerData();
		});

		; (function () {
			const TEXTS = [];
			const TEXT_COLORS = [];
			const container = document.createElement('div');
			container.id = 'clickEffectContainer';
			container.style.cssText = `
        position: fixed; top: 0; left: 0; 
        width: 100%; height: 100%;
        pointer-events: none;
        z-index: 9999;
    `;
			document.body.appendChild(container);
			const EXCLUDE_SELECTORS = [
				'button', 'a', 'input', 'select', 'textarea',
				'[onclick]', '.nav-item', '.menu-btn'
			];
			document.addEventListener('click', (e) => {
				if (!EXCLUDE_SELECTORS.some(sel => e.target.closest(sel))) {
					createTextEffect(e.clientX, e.clientY);
					createPeachBlossomEffect(e.clientX, e.clientY);
					window.clickCount = (window.clickCount || 0) + 1;
				}
			}, true);
			function createTextEffect(x, y) {
				const effect = document.createElement('div');
				effect.style.cssText = `
            position: absolute;
            left: ${x}px; top: ${y}px;
            font: bold 18px 楷体, KaiTi;
            color: ${TEXT_COLORS[window.clickCount % TEXT_COLORS.length]};
            pointer-events: none;
            user-select: none;
            animation: float 2s forwards;
            text-shadow: 0 0 5px rgba(255,255,255,0.7);
            z-index: 10000;
        `;
				effect.textContent = TEXTS[window.clickCount % TEXTS.length];
				container.appendChild(effect);
				setTimeout(() => effect.remove(), 2000);
			}
			function createPeachBlossomEffect(x, y) {
				const petalCount = 15;
				const duration = 3000;
				const petalSVG = encodeURIComponent(`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path fill="#FFEEF7" d="M12,2C13.1,2 14,2.9 14,4C14,5.1 13.1,6 12,6C10.9,6 10,5.1 10,4C10,2.9 10.9,2 12,2M15.5,8C16.3,8 17,8.7 17,9.5C17,10.3 16.3,11 15.5,11C14.7,11 14,10.3 14,9.5C14,8.7 14.7,8 15.5,8M8.5,8C9.3,8 10,8.7 10,9.5C10,10.3 9.3,11 8.5,11C7.7,11 7,10.3 7,9.5C7,8.7 7.7,8 8.5,8M12,11C13.1,11 14,11.9 14,13C14,14.1 13.1,15 12,15C10.9,15 10,14.1 10,13C10,11.9 10.9,11 12,11M19,17V19H5V17C5,14.8 8.1,13 12,13C15.9,13 19,14.8 19,17Z"/>
                <path fill="#FFD6EB" d="M12,4C11.4,4 11,4.4 11,5C11,5.6 11.4,6 12,6C12.6,6 13,5.6 13,5C13,4.4 12.6,4 12,4Z"/>
            </svg>
        `);
				for (let i = 0; i < petalCount; i++) {
					const petal = document.createElement('div');
					const size = 15 + Math.random() * 10;
					const rotation = Math.random() * 360;
					const delay = Math.random() * 500;
					petal.style.cssText = `
                position: absolute;
                left: ${x}px;
                top: ${y}px;
                width: ${size}px;
                height: ${size}px;
                background: url('data:image/svg+xml;utf8,${petalSVG}');
                background-size: contain;
                pointer-events: none;
                z-index: 9998;
                opacity: 0.9;
                transform: rotate(${rotation}deg);
                animation: petal-fall ${duration}ms ease-out ${delay}ms forwards;
                filter: drop-shadow(0 0 2px rgba(255,200,230,0.7));
            `;
					container.appendChild(petal);
					const angle = Math.random() * Math.PI * 2;
					const distance = 50 + Math.random() * 100;
					const endX = x + Math.cos(angle) * distance;
					const endY = y + Math.sin(angle) * distance + 100;
					const keyframes = `
                @keyframes petal-fall-${i} {
                    0% { 
                        transform: translate(0, 0) rotate(${rotation}deg); 
                        opacity: 0.9;
                    }
                    100% { 
                        transform: translate(${endX - x}px, ${endY - y}px) rotate(${rotation + 180}deg);
                        opacity: 0;
                    }
                }
            `;
					const style = document.createElement('style');
					style.textContent = keyframes;
					document.head.appendChild(style);
					petal.style.animationName = `petal-fall-${i}`;
					setTimeout(() => petal.remove(), duration + delay);
				}
			}
			const style = document.createElement('style');
			style.textContent = `
        @keyframes float {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }
    `;
			document.head.appendChild(style);
		})();
	</script>
</body>
<script type="text/javascript">
	const directory = document.querySelectorAll('.target-fix');
	const links = document.querySelectorAll('.top a');
	const dropdownLinks = document.querySelectorAll('.dropdown-content a');
	const dropbtn = document.querySelector('.dropbtn');
	window.addEventListener('scroll', function () {
		let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
		let ed = -1;
		links.forEach(link => link.classList.remove("selected"));
		dropbtn.classList.remove("selected");
		for (let i = 0; i < directory.length; i++) {
			if (directory[i].offsetTop <= scrollTop + 10) {
				ed = i;
			}
		}
		if (ed !== -1) {
			links[ed].classList.add("selected");
			const selectedLink = links[ed];
			const isDropdownItem = Array.from(dropdownLinks).includes(selectedLink);
			if (isDropdownItem) {
				dropbtn.classList.add("selected");
			}
		}
	});
	window.onresize = () => {
		if (window.innerWidth < 686) document.querySelector('.top ul').style.display = "none";
		else document.querySelector('.top ul').style.display = "block";
	}
</script>

</html>